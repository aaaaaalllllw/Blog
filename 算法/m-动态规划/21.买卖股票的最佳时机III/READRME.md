## 买卖股票的最佳时机

注意：你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。
最多两表交易
示例 1: 输入：prices = [3,3,5,0,0,3,1,4] 输出：6 解释：在第 4 天（股票价格 = 0）的时候买入，在第 6 天（股票价格 = 3）的时候卖出，这笔交易所能获得利润 = 3-0 = 3 。随后，在第 7 天（股票价格 = 1）的时候买入，在第 8 天 （股票价格 = 4）的时候卖出，这笔交易所能获得利润 = 4-1 = 3。

## 思路

1. 确定 dp 数组以及下标的含义
   一天一共就五个状态 0. 没有操作

1. 第一次持有股票
1. 第二次不持有股票
1. 第二次持有股票
1. 第二次不持有股票

**dp[i][j] i 表示第 i 天，j 为[0-4]五个状态，dp[i][j]表示第 i 天状态 j 所剩最大现金**
dp[i][1]，表示第 i 天，买入股票的状态，并不是说一定要第 i 天买入股票

2. 确定递推公式

达到 dp[i][1]状态，有两个具体操作:

- 操作一:第 i 天买入股票，那么 dp[i][1]=dp[i-1][0]-prices[i]
- 操作二:第 i 天没有操作，沿用前一天卖出的股票的状态即：dp[i][1]=dp[i-1][1]
  dp[i][1]=Math.max(dp[i-1][0]-prices[i],dp[i-1][1])

同理 dp[i][2]也有两个操作

- 操作一：第 i 天卖出股票了，那么 dp[i][2] = dp[i - 1][1] + prices[i]
- 操作二：第 i 天没有操作，沿用前一天卖出股票的状态，即：dp[i][2] = dp[i - 1][2]
  所以 dp[i][2] = max(dp[i - 1][1] + prices[i], dp[i - 1][2])

3. dp 数组如何初始化

第 0 天没有操作，这个最容易想到，就是 0，即：dp[0][0] = 0;

第 0 天做第一次买入的操作，dp[0][1] = -prices[0];

第 0 天做第一次卖出的操作，这个初始值应该是多少呢？

此时还没有买入，怎么就卖出呢？ 其实大家可以理解当天买入，当天卖出，所以 dp[0][2] = 0;

第 0 天第二次买入操作，初始值应该是多少呢？应该不少同学疑惑，第一次还没买入呢，怎么初始化第二次买入呢？

第二次买入依赖于第一次卖出的状态，其实相当于第 0 天第一次买入了，第一次卖出了，然后再买入一次（第二次买入），那么现在手头上没有现金，只要买入，现金就做相应的减少。

所以第二次买入操作，初始化为：dp[0][3] = -prices[0];

同理第二次卖出初始化 dp[0][4] = 0;

4. 确定遍历顺序 从前到后

5. 举例推导 dp 数组
   ![这是图片](./1.png)

## 代码

```js
function maxProfit(prices) {
  if (prices.length == 0) return 0;
  let dp = new Array(prices.length).fill(0).map(() => new Array(5).fill(0));
  dp[0][1] = -prices[0];
  dp[0][3] = -prices[0];
  for (let i = 1; i < prices.length; i++) {
    dp[i][0] = dp[i - 1][0];
    dp[i][1] = Math.max(dp[i - 1][1], dp[i - 1][0] - prices[i]);
    dp[i][2] = Math.max(dp[i - 1][2], dp[i - 1][1] + prices[i]);
    dp[i][3] = Math.max(dp[i - 1][3], dp[i - 1][2] - prices[i]);
    dp[i][4] = Math.max(dp[i - 1][4], dp[i - 1][3] + prices[i]);
  }
  return dp[prices.length - 1][4];
}
```
