尝试过不借用 vue-cli，初始化一个项目，下载 webpack 来构建一个项目

webpack 本质上是一个函数，接收一个配置信息作为参数，执行后返回一个
**complier 对象**，调用 complier 对象中的 run 方法会启动编译。run 方法接收一个回调，可以查看编译过程中错误信息和编译信息

debugger.js

```js
const { webpack } = require("webpack");
const webpackOptions = require("./webpack.config.js");
const complier = webpack(webpackOptions);

//开始编译
compiler.run((err, stats) => {
	console.log(err);
	console.log(
		stats.toJson({
			assets: true, //打印本次编译产出的资源
			chuncks: true, //打印本次编译产出的代码块
			modules: true, //打印本次编译产出的模块
		})
	);
});
```

执行打包命令

```js
node ./debugger.js

```

# 三、核心思想

![这是图片](1.webp)

入口文件(src/index.js)被包裹在最后立即执行函数中，而它所依赖的模块（src/name.js、src/age.js）则被放进了 modules 对象中（modules 用于存放入口文件的依赖模块，key 值为依赖模块路径，value 值为依赖模块源代码）。

## 步骤

1. 首先，根据配置信息(webpack.config.js)找到入口文件(src/index.js)

2. 找到入口文件依赖的模块，收集关键信息：比如路径、源代码、它所依赖的模块等

```js
var modules = [
	{
		id: "./src/name.js", //路径
		dependencies: [], //所依赖的模块
		source: 'module.exports = "不要秃头啊";', //源代码
	},
	{
		id: "./src/age.js",
		dependencies: [],
		source: 'module.exports = "99";',
	},
	{
		id: "./src/index.js",
		dependencies: ["./src/name.js", "./src/age.js"],
		source:
			'const name = require("./src/name.js");\n' +
			'const age = require("./src/age.js");\n' +
			'console.log("entry文件打印作者信息", name, age);',
	},
];
```

3. 根据上一步得到的信息，生成最终输出到硬盘中文件(dist)

在这个过程中，浏览器并不认识 html、css、jd 以外的格式，所有还需要对源文件进行转化-Loader 系统

**Loader 系统** 本质上就是接收资源文件，并对其进行转换，最终输出转换后的文件：
![这是图片](2.webp)

**Plugin 系统**:本质上就是一种事件流的机制，到了固定的时间节点就广播特定的时间，用户可以在事件内执行特定的逻辑，类似与生命周期

![这是图片](3.webp)

# 四、架构设计

整个打包过程，大致可以分为三个阶段

- 打包开始前的准备工作
- 打包过程(也就是编译阶段)
- 打包结束后(包含打包成功和打包失败)

**将打包过程单独解耦出来**就是 compilation

complier 就像是一个大管家，它就代表上面说的三个阶段，在它上面挂载着各种生命周期函数，而 compilation 就像专管伙食的厨师，专门负责编译相关的工作，也就是打包过程中这个阶段。

![这是图片](4.webp)

# 五、具体实现

整个过程大致分为以下步骤

1. 搭建结构、读取配置参数
2. 用配置参数对象初始化 Compiler 对象
3. 挂载配置文件中的插件
4. 执行 Complier 对象的 run 方法开始执行编译
5. 根据配置文件中 entry 配置找到所有的入口
6. 从入口文件出发，调用配置的 loader 规则，对模块进行编译
7. 找出此模块所依赖的模块，再对依赖模块进行编译
8. 等所有模块都编译完成后，根据模块之间的依赖关系，组装代码块 chunck
9. 把各个代码块 chunck 转换成一个个文件加入到输出列表中
10. 确定好输出内容之后，根据配置的输出路径和文件名，将文件写入文件系统中

## 5.1
